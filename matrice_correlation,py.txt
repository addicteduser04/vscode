import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# === 1. Charger les données ===
df = pd.read_csv("DROP_FREATURES.csv")  # Remplace par ton vrai nom de fichier

# === 2. Encoder la colonne D/C ===
# Assure-toi que la colonne s'appelle bien "D/C"
df['D/C_ENCODED'] = df['D/C'].apply(lambda x: 1 if str(x).strip().upper() == 'D' else 0)

# === 3. Encoder ACCOUNT_DC ===
def encode_account_dc(value):
    if pd.isna(value):
        return None
    number, sens = str(value).split('_')
    number = int(number)
    return number if sens == 'D' else 0  # 0 si Crédit, sinon valeur positive

df['ACCOUNT_DC_ENCODED'] = df['ACCOUNT_DC'].apply(encode_account_dc)


# === 5. Préparer les colonnes pour corrélation ===
colonnes_corr = [
    'ACCOUNT', 
    'AMOUNT', 
    'SOURCE', 
    'D/C_ENCODED', 
    'ACCOUNT_DC_ENCODED', 
    'AMOUNT_POSITIVE', 
    'Fabricated_JE', 
    'TYPE'
]

# Supprimer les colonnes manquantes si elles n'existent pas dans le dataset
colonnes_corr = [col for col in colonnes_corr if col in df.columns]

# === 6. Matrice de corrélation ===
corr_matrix = df[colonnes_corr].corr()

# === 7. Affichage ===
plt.figure(figsize=(10, 8))
sns.heatmap(corr_matrix, annot=True, cmap='viridis', vmin=-1, vmax=1, center=0, square=True)
plt.title('Matrice de corrélation des variables (encodées)')
plt.tight_layout()
plt.show()
